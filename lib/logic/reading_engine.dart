import 'dart:math';

enum QuestionType {
  selection, // 空欄補充などの選択問題
  extract,   // 抜き出し（4択化）
  trueFalse, // 正誤判断
}

class ReadingQuestion {
  final String text; // 設問文
  final QuestionType type;
  final List<String> options; // 選択肢
  final String answer; // 正解の選択肢文字列
  final String explanation; // 解説

  ReadingQuestion({
    required this.text,
    required this.type,
    required this.options,
    required this.answer,
    required this.explanation,
  });
}

class ReadingProblem {
  final String title; // "練習問題①" etc
  final String text; // 本文
  final String source; // 出典
  final List<ReadingQuestion> questions; // 小問3つ

  ReadingProblem({
    required this.title,
    required this.text,
    required this.source,
    required this.questions,
  });
}

class ReadingEngine {
  final Random _rand = Random();

  final List<ReadingProblem> _allProblems = [
    // 1. 練習問題① (インフラストラクチュア)
    ReadingProblem(
      title: "練習問題①",
      text:
          "整備しなければならない社会的インフラストラクチュアは、情報・知識産業、あるいは知識集約型産業を支える基盤として機能する社会的インフラストラクチュアでなければならない。知識集約型産業の基盤となるのは、人間そのものの知的能力と社会資本である。つまり知識資本である。新しい知識集約型産業は、指をくわえて待っていても生まれない。知的能力の高い人間が存在するようになって、はじめて誕生する。しかも、ひとりの天才のひらめきからでは、新しい産業構造の創出は無理である。社会の構成員が、それぞれの[　　]を高めなければならない。つまり、知識集約型産業は知的能力の基盤がなければ誕生しないのである。しかも、高い知識能力を育成できた国に、企業も移動してこざるをえなくなる。こうした知的能力の育成や研究開発に効果をあげるには、時間を必要とする。",
      source: "『人間回復の経済学』神野直彦、岩波書店",
      questions: [
        ReadingQuestion(
          text: "文中の空欄[　　]に入る語句として適切なのは、次のうちどれか。",
          type: QuestionType.selection,
          options: ["社会資本", "知的能力", "産業創出", "育成能力"],
          answer: "知的能力",
          explanation: "新しい知識集約型産業の基盤となるのは「人間そのものの知的能力」であると述べられている。社会の構成員がそれぞれ高めなければならないのは、この「知的能力」。",
        ),
        ReadingQuestion(
          text: "整備すべき社会的インフラストラクチュアとは何か。文中から5文字以内で抜き出しなさい。",
          type: QuestionType.extract,
          options: ["社会資本", "知的能力", "知識資本", "産業構造"],
          answer: "知識資本",
          explanation: "「知識集約型産業の基盤となるのは…つまり知識資本である」と述べられている。",
        ),
        ReadingQuestion(
          text: "文中で述べられていることから判断して、次のア、イの正誤を答えなさい。\n\nア：新しい知識集約型産業の創出には天才のひらめきが必要である。\nイ：この文で述べられている「社会的インフラストラクチュアの整備」が効果をあげるには、時間がかかる。",
          type: QuestionType.trueFalse,
          options: ["アもイも正しい", "アは正しいがイは誤り", "アは誤りだがイは正しい", "アもイも誤り"],
          answer: "アは誤りだがイは正しい",
          explanation: "ア：「ひとりの天才のひらめきからでは、新しい産業構造の創出は無理」とあるので誤り。\nイ：末尾に「効果をあげるには、時間を必要とする」とあるので正しい。",
        ),
      ],
    ),

    // 2. 練習問題② (資源)
    ReadingProblem(
      title: "練習問題②",
      text:
          "資源は鉱物資源と生物資源とに大きく分けられる。【A】石油や鉄のような鉱物資源には資源を再生産する能力がないので、それらを人類が利用すれば資源の量は減少し、やがて消滅する危険が迫ることになる。それ故に、鉱物資源の利用を節約したり、利用しないままにしたりするような方策は、われわれの子孫が将来それらを利用する可能性を残す意味で大切である。また、鉱物資源は利用しないでおいても、よほどの天変地異がない限り、将来もそのままの状態で残るはずである。【B】これに対して、生物資源は、再生産・成長・自然死亡という鉱物資源にはない特性をもっているので、その再生産能力の範囲内で資源を利用し続けたとしても、資源が減少することはない。したがって、生物資源を利用しないでおくことはもったいないことであり、これを保護することが将来の利用に備えることにはならない。【C】しかし、生物資源はそれを取りまく生物環境、非生物環境および生物資源を利用する漁業などの産業の影響を受け、同時にそれらに影響を与えながら存在する。【D】",
      source: "『クジラと日本人』大隅清治、岩波書店",
      questions: [
        ReadingQuestion(
          text: "次の1文を挿入するのに最も適切な場所を、文中の【A】から【D】から選びなさい。\n\n「つまり、生物資源は環境の影響を受けやすく、十分にその環境を管理しないと資源に変動を来すことになる。」",
          type: QuestionType.selection,
          options: ["【A】", "【B】", "【C】", "【D】"],
          answer: "【D】",
          explanation: "挿入文は「つまり」で始まっており、直前の内容（生物資源は環境の影響を受ける）を要約している。したがって【D】が適切。",
        ),
        ReadingQuestion(
          text: "次の文は、本文の要旨である。[　　]に入る語句を文中から5文字以内で抜き出しなさい。\n\n「生物資源は鉱物資源とは異なり、[　　]をもつ。」",
          type: QuestionType.extract,
          options: ["再生能力", "自然死亡", "生産能力", "資源利用"],
          answer: "再生能力",
          explanation: "本文に「再生産能力の範囲内で」とあり、生物資源の特性として「再生能力」をもつと言い換えられる。",
        ),
        ReadingQuestion(
          text: "文中で述べられていることから判断して、次のア、イの正誤を答えなさい。\n\nア：鉱物資源を利用しないでおくことに意味はない。\nイ：生物資源は漁業などの産業と相互に影響を与え合っている。",
          type: QuestionType.trueFalse,
          options: ["アもイも正しい", "アは正しいがイは誤り", "アは誤りだがイは正しい", "アもイも誤り"],
          answer: "アは誤りだがイは正しい",
          explanation: "ア：「将来それらを利用する可能性を残す意味で大切」とあるので誤り。\nイ：「漁業などの産業の影響を受け、同時にそれらに影響を与えながら存在する」とあるので正しい。",
        ),
      ],
    ),

    // 3. 練習問題③ (地球温暖化)
    ReadingProblem(
      title: "練習問題③",
      text:
          "地球温暖化は世界の食料生産に対しては、プラスに働く地域、マイナスに働く地域が混在し、全体として見たとき、人類に対しそれほど深刻な影響を与えることはなさそうである。【A】しかし、それでは全面的に安心してよいのであろうか。それはまた違った話である。人類が農耕を始めてからの時間は約1万年であるが、この中で、ここ3000年くらいの気候は比較的温暖で安定していた。\n【B】 人類はこの安定した時代に、その地域地域に特有の文化・文明を築いてきた。農耕では、どこでだれが何をつくるというルールを決めてきた。小麦は比較的乾燥し、かつ少し寒いところ、また、水稲はアジアモンスーン地帯でつくり、それに対応した人口密度になっていった。シベリアやカナダに森林が多く、ほとんど人がいないのは、そこが耕地には適さなかったからである。【C】温暖化により、日本ではコシヒカリが北海道で大量に栽培されている可能性があるし、旱魃（かんばつ）が常態化するアメリカから穀物を大量に購入することが不可能になり、温暖化に伴い新たに出現した広大な穀倉地帯を有するロシアやカナダから穀物を買うことになるかもしれない。また、人口密度の高い中国南部や東南アジアの降雨量が増し治水のコストがかさむようになり、かつ中国東北地区やロシアに穀物栽培に適する土地が広がるとしたら、それは世界の人口分布、経済、政治に大きな影響を与えるであろう。100年後に、地球全体で食料をつくることができなくなる可能性は少ないが、長い人類の歴史から見ればきわめて短い時間で耕作適地が大きく変動する可能性がある。【D】",
      source: "『二十一世紀の食料生産』川島博之、東京大学出版会",
      questions: [
        ReadingQuestion(
          text: "次の1文を挿入するのに最も適切な場所を、文中の【A】から【D】から選びなさい。\n\n「そのようなルールが、次の100年で急激に変わる可能性がある。」",
          type: QuestionType.selection,
          options: ["【A】", "【B】", "【C】", "【D】"],
          answer: "【C】",
          explanation: "「そのようなルール」とは直前で述べられている「どこでだれが何をつくるというルール」のこと。【C】の後ろでルール変更の具体例が述べられている。",
        ),
        ReadingQuestion(
          text: "文中下線部の「それ」が指すものは、次のうちどれか。",
          type: QuestionType.selection,
          options: ["穀物栽培", "地球温暖化", "モンスーン", "人口密度"],
          answer: "地球温暖化",
          explanation: "文脈から、治水コスト増大や耕作適地の変化を引き起こす原因である「地球温暖化（による気候変動）」を指している。",
        ),
        ReadingQuestion(
          text: "文中で述べられていることから判断して、次のア、イの正誤を答えなさい。\n\nア：地球温暖化によって、現在の耕作適地が大きく変動する可能性がある。\nイ：地球温暖化によって、新しく穀倉地帯が出現する可能性がある。",
          type: QuestionType.trueFalse,
          options: ["アもイも正しい", "アは正しいがイは誤り", "アは誤りだがイは正しい", "アもイも誤り"],
          answer: "アもイも正しい",
          explanation: "ア：「耕作適地が大きく変動する可能性がある」と述べられている。\nイ：「温暖化に伴い新たに出現した広大な穀倉地帯を有するロシアやカナダ」という記述がある。",
        ),
      ],
    ),

    // 4. 例題 (ファンタジー)
    ReadingProblem(
      title: "例題",
      text:
          "ファンタジーを創る場合、描写力、文章力に負うところがひじょうに大きいと、私はがんこに思っている。一言でいえば、日常にあり得ることを描いて他に伝えようとすることさえ、一節なわではいかないのに、ましてあり得ないことをあり得るように描いて納得させようというのだから、よほど的確な表現技術がなければ、うまくいくわけがないのである。【A】しかし、そのことは抜きにしても、私にとって表現技術は重要である。\nいつのころからか、技術主義などという言葉があって、なんとなく軽侮するような空気がある。だからといって、技術（ここでは文章技術、言葉の選択から句読点のつけ方まで）そのものを軽侮してはならない。【B】なぜなら、われわれは[　　]によって考えを発展させるからだ。言葉が思考を生み、その思考がまた言葉を生む。思考に力があるように言葉にも力があって、この力は創作中にも具体的に働く。書かれた文章が内容を展開させたり修正させたりするので、作者自身までしばしば意表をつかれる思いをする。【C】このことを「手が考える」という。もちろん手が考えるわけはなく、文章によって表現され、すでに定着されたいくつかのことがらが、知らず知らずのうちに頭のどこか底のほうで複雑に結びつき合って、1つの解答を提示してくるのだろう。【D】よりよい文章を書こうとする努力がともなってはじめて起こるので、それでこのことを「手が考える」というのである。",
      source: "『ファンタジーの世界』佐藤さとる",
      questions: [
        ReadingQuestion(
          text: "次の1文を挿入するのに最も適切な場所を、文中の【A】から【D】から選びなさい。\n\n「だが、こんなことは書いていないとけっして起こらない。」",
          type: QuestionType.selection,
          options: ["【A】", "【B】", "【C】", "【D】"],
          answer: "【D】",
          explanation: "「こんなこと」は「手が考える（思考が発展する）」現象を指す。Dの後ろに「努力がともなってはじめて起こる」と続くので、Dが適切。",
        ),
        ReadingQuestion(
          text: "文中の空欄[　　]に入る語句を文中から2文字で抜き出しなさい。",
          type: QuestionType.extract,
          options: ["言葉", "思考", "技術", "内容"],
          answer: "言葉",
          explanation: "直後に「言葉が思考を生み、その思考がまた言葉を生む」とあるので、[　　]に入るのは「言葉」。",
        ),
        ReadingQuestion(
          text: "文中で述べられていることから判断して、次のア、イの正誤を答えなさい。\n\nア：言葉の力によって、書いている作者自身が意表をつかれることがある。\nイ：「手が考える」とは、表現技術にとらわれない創作方法のことである。",
          type: QuestionType.trueFalse,
          options: ["アもイも正しい", "アは正しいがイは誤り", "アは誤りだがイは正しい", "アもイも誤り"],
          answer: "アは正しいがイは誤り",
          explanation: "ア：「作者自身までしばしば意表をつかれる思いをする」とあるので正しい。\nイ：「手が考える」には「よりよい文章を書こうとする努力（表現技術）」が必要と述べているので、誤り。",
        ),
      ],
    ),
  ];

  ReadingProblem getRandomProblem() {
    return _allProblems[_rand.nextInt(_allProblems.length)];
  }
}
